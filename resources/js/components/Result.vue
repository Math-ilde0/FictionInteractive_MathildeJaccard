<template>
  <main>
    <!-- R√©sultat de succ√®s -->
    <div v-if="outcome === 'success'" class="result result-success">
      <h2>üèÜ F√©licitations !</h2>
      <p>Vous avez brillamment g√©r√© votre charge mentale et maintenu votre √©quilibre pour r√©ussir votre semestre !</p>
      <div class="achievement">
        <span>üåü D√©verrouill√© : Ma√Ætre de la S√©r√©nit√©</span>
      </div>
      <div class="advice-box">
        <h3>Techniques √† retenir</h3>
        <ul>
          <li>Planification et organisation des t√¢ches</li>
          <li>Priorisation des activit√©s importantes</li>
          <li>Pauses r√©guli√®res pour maintenir l'√©quilibre</li>
          <li>Communication de vos limites</li>
          <li>Soin de votre sant√© physique et mentale</li>
        </ul>
      </div>
    </div>

    <!-- R√©sultat interm√©diaire (proche du burn-out) -->
    <div v-else-if="outcome === 'warning'" class="result result-warning">
      <h2>‚ö†Ô∏è Vous avez √©vit√© le pire !</h2>
      <p>Vous avez fr√¥l√© l'√©puisement. Bien que vous ayez termin√© votre semestre, votre sant√© mentale en a souffert.</p>
      <div class="advice-box">
        <h3>Conseils pour la suite</h3>
        <ul>
          <li>Identifiez les signes avant-coureurs du stress</li>
          <li>√âtablissez des limites plus claires</li>
          <li>Pratiquez la pleine conscience quotidiennement</li>
          <li>Consultez un professionnel si les sympt√¥mes persistent</li>
          <li>Pr√©voyez des p√©riodes de r√©cup√©ration</li>
        </ul>
      </div>
    </div>

    <!-- Burn-out (charge mentale √† 10) -->
    <div v-else-if="outcome === 'failure'" class="result result-failure">
      <h2>üî• Burn-out d√©tect√©</h2>
      <p>Votre charge mentale a atteint un niveau critique. Il est essentiel de faire une pause et de chercher du soutien.</p>

      <div class="emergency-resources">
        <h3>üìö Trouver de l'aide</h3>

        <h4>üß† Permanences en ligne et t√©l√©phoniques</h4>
        <ul>
          <li><strong><a href="https://www.147.ch" target="_blank">147.ch</a></strong> ‚Äì Ligne gratuite 24h/24 pour les jeunes (t√©l√©phone, chat, SMS, e-mail).</li>
          <li><strong><a href="https://www.ontecoute.ch" target="_blank">Ontecoute.ch</a></strong> ‚Äì Questions anonymes aux professionnel¬∑le¬∑s, forum, adresses utiles.</li>
        </ul>

        <h4>üè• Associations romandes de soutien</h4>
        <ul>
          <li><strong><a href="https://www.santepsy.ch" target="_blank">Sant√©Psy</a></strong> ‚Äì Infos et outils pour mieux g√©rer les difficult√©s psychiques.</li>
          <li><strong><a href="https://www.noburnout.ch" target="_blank">No burnout</a></strong> ‚Äì √âvaluation personnelle et pr√©vention de l'√©puisement professionnel.</li>
        </ul>

        <h4>üéì Ressources √©tudiantes √† la HEIG-VD</h4>
        <ul>
          <li><strong>Service de sant√©</strong> ‚Äì Infirmi√®res disponibles pour vous accueillir, √©valuer et orienter.</li>
          <li><strong>Aum√¥nerie</strong> ‚Äì Service d'√©coute et de dialogue interreligieux/interculturel.</li>
        </ul>
      </div>
    </div>

    <!-- Crise de sommeil (sommeil √† 0) -->
    <div v-else-if="outcome === 'sleep-crisis'" class="result result-sleep">
      <h2>üò¥ √âpuisement physique</h2>
      <p>Vous vous √™tes litt√©ralement endormi(e) en cours. Le manque de sommeil a eu raison de vous.</p>
      
      <div class="scenario-description">
        <p>Lundi, 10h30. Au milieu du cours de programmation, votre t√™te s'est mise √† dodeliner. Malgr√© vos efforts, vos paupi√®res sont devenues trop lourdes. Vous vous √™tes effondr√©(e) sur votre clavier, sous le regard inquiet de vos camarades.</p>
        <p>L'infirmi√®re de l'√©cole vous a plac√©(e) en observation √† l'infirmerie. Verdict : √©puisement s√©v√®re d√ª √† un manque chronique de sommeil.</p>
      </div>
      
      <div class="advice-box">
        <h3>Importance du sommeil pour les √©tudiants</h3>
        <ul>
          <li><strong>Consolidation de la m√©moire</strong> - Le sommeil est essentiel pour int√©grer les connaissances acquises pendant la journ√©e</li>
          <li><strong>Capacit√© de concentration</strong> - La privation de sommeil diminue consid√©rablement vos facult√©s d'attention</li>
          <li><strong>Syst√®me immunitaire</strong> - Un sommeil insuffisant vous rend plus vuln√©rable aux maladies</li>
          <li><strong>Gestion du stress</strong> - Dormir permet de r√©guler les hormones du stress</li>
        </ul>
      </div>
    </div>

    <!-- Crise acad√©mique (notes √† 0) -->
    <div v-else-if="outcome === 'academic-crisis'" class="result result-academic">
      <h2>üìâ √âchec acad√©mique</h2>
      <p>Vos notes se sont effondr√©es au point que vous ne pouvez plus valider votre semestre.</p>
      
      <div class="scenario-description">
        <p>Le conseil des professeurs vient de se r√©unir pour examiner votre situation acad√©mique. Le verdict est sans appel : vos r√©sultats sont insuffisants pour continuer.</p>
        <p>Une r√©orientation ou un redoublement sont d√©sormais √† envisager. Le conseiller aux √©tudes vous invite √† le rencontrer pour discuter des options.</p>
      </div>
      
      <div class="advice-box">
        <h3>Rebondir apr√®s un √©chec acad√©mique</h3>
        <ul>
          <li><strong>Analyser les causes</strong> - Identifier ce qui a conduit √† cette situation</li>
          <li><strong>Demander de l'aide</strong> - Consulter les services d'orientation et les conseillers acad√©miques</li>
          <li><strong>Red√©finir ses objectifs</strong> - Parfois, un √©chec est l'occasion de repenser son parcours</li>
          <li><strong>Am√©liorer sa m√©thode</strong> - Revoir ses techniques d'apprentissage et d'organisation</li>
          <li><strong>Garder confiance</strong> - Un √©chec n'est pas une fatalit√© mais une √©tape d'apprentissage</li>
        </ul>
      </div>
    </div>

    <!-- Message d'erreur par d√©faut -->
    <div v-else class="result result-error">
      <h2>‚ö†Ô∏è Une erreur s'est produite</h2>
      <p>Nous ne pouvons pas afficher le r√©sultat demand√©.</p>
    </div>

    <!-- Boutons d'action -->
    <div class="result-actions">
      <router-link to="/" class="button primary">Retour √† l'accueil</router-link>
      <button @click="restartGame" class="button secondary">R√©essayer</button>
    </div>
  </main>
</template>

<script setup>
import { computed } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import axios from 'axios';

const route = useRoute();
const router = useRouter();

// R√©cup√®re le type de r√©sultat depuis les param√®tres de route
const outcome = computed(() => route.params.outcome);

// Fonction pour recommencer le jeu
const restartGame = async () => {
  try {
    // R√©initialiser toutes les m√©triques
    await axios.post('/api/metrics/reset');
    
    // Effacer la progression sauvegard√©e
    localStorage.removeItem('storyProgress');
    
    // Retourner √† la liste des histoires
    router.push('/');
  } catch (error) {
    console.error('Erreur lors du red√©marrage:', error);
    // En cas d'√©chec, rediriger quand m√™me vers l'accueil
    router.push('/');
  }
};
</script>

<style scoped>
.result {
  max-width: 800px;
  margin: 0 auto;
  padding: 30px;
  border-radius: 10px;
  color: #333;
  margin-bottom: 20px;
}

.result h2 {
  font-size: 2rem;
  margin-bottom: 20px;
  text-align: center;
}

.result p {
  font-size: 1.2rem;
  line-height: 1.6;
  margin-bottom: 20px;
}

.result-success {
  background-color: #e8f5e9;
  border-left: 5px solid #66bb6a;
}

.result-warning {
  background-color: #fff8e1;
  border-left: 5px solid #ffd54f;
}

.result-failure {
  background-color: #ffebee;
  border-left: 5px solid #ef5350;
}

.result-sleep {
  background-color: #e3f2fd;
  border-left: 5px solid #42a5f5;
}

.result-academic {
  background-color: #ede7f6;
  border-left: 5px solid #7e57c2;
}

.result-error {
  background-color: #f5f5f5;
  border-left: 5px solid #9e9e9e;
}

.achievement {
  background-color: rgba(0, 0, 0, 0.05);
  padding: 10px 15px;
  border-radius: 5px;
  text-align: center;
  margin: 20px 0;
  font-weight: bold;
}

.scenario-description {
  font-style: italic;
  background-color: rgba(0, 0, 0, 0.05);
  padding: 15px;
  border-radius: 5px;
  margin: 20px 0;
}

.advice-box {
  background-color: white;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  margin-top: 20px;
}

.advice-box h3 {
  margin-top: 0;
  color: #555;
  font-size: 1.3rem;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
  margin-bottom: 15px;
}

.advice-box ul {
  padding-left: 20px;
}

.advice-box li {
  margin-bottom: 10px;
  list-style-type: none;
  position: relative;
  padding-left: 20px;
}

.advice-box li:before {
  content: "‚Üí";
  position: absolute;
  left: 0;
  color: #555;
}

.emergency-resources {
  background-color: white;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  margin-top: 20px;
}

.emergency-resources h3 {
  color: #d32f2f;
  margin-top: 0;
}

.emergency-resources h4 {
  margin-top: 20px;
  margin-bottom: 10px;
  color: #555;
}

.emergency-resources ul {
  padding-left: 20px;
}

.emergency-resources li {
  margin-bottom: 8px;
}

.emergency-resources a {
  color: #1976d2;
  text-decoration: none;
}

.emergency-resources a:hover {
  text-decoration: underline;
}

.result-actions {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 30px;
}

.button {
  padding: 12px 25px;
  border: none;
  border-radius: 5px;
  font-size: 1.1rem;
  cursor: pointer;
  text-decoration: none;
  transition: background-color 0.3s;
}

.primary {
  background-color: #66bb6a;
  color: white;
}

.primary:hover {
  background-color: #4caf50;
}

.secondary {
  background-color: #bdbdbd;
  color: white;
}

.secondary:hover {
  background-color: #9e9e9e;
}

@media (max-width: 768px) {
  .result {
    padding: 20px;
  }
  
  .result h2 {
    font-size: 1.8rem;
  }
  
  .result-actions {
    flex-direction: column;
    gap: 10px;
  }
  
  .button {
    width: 100%;
    text-align: center;
  }
}
</style>